<!--
Copyright (c) Márk Csörgő and Martin Bartos
Licensed under the MIT License. See LICENSE file for details.
-->

<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:templatedControls="clr-namespace:avallama.Styles.TemplatedControls"
        xmlns:controls="clr-namespace:avallama.Controls"
        xmlns:dataTemplates="clr-namespace:avallama.DataTemplates"
        xmlns:download="clr-namespace:avallama.Models.Download"
        xmlns:services="clr-namespace:avallama.Services"
        xmlns:vm="clr-namespace:avallama.ViewModels"
        x:DataType="vm:ModelItemViewModel">
    <Design.PreviewWith>

        <!-- To preview the items in Light/Dark theme change the RequestedThemeVariant to "Light" or to "Dark" -->
        <ThemeVariantScope RequestedThemeVariant="Light">
            <Border Background="{DynamicResource SurfaceContainer}">
                <StackPanel Orientation="Vertical"
                            Spacing="20" Margin="20"
                            MaxWidth="350">

                    <!-- Sample item 1 - Downloaded ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="llama-3.2:latest">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Downloaded" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 2 - Downloaded ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="deepseek-r1:8b-llama-distill-q4_K_M">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Downloaded" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 3 - Downloading ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="gpt-oss:20b"
                        Classes="selectedListItem">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Downloading" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                        <templatedControls:ModelListItem.StatusText>3.00%</templatedControls:ModelListItem.StatusText>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 4 - Paused ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="qwen:14b">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Downloaded" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 5 - Downloading ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="deepseek-r1:70b-llama-distill-q4_K_M">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Downloading" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                        <templatedControls:ModelListItem.StatusText>43.57%</templatedControls:ModelListItem.StatusText>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 6 - Downloadable ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="qwen3-coder:480b-a35b-q4_K_M">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Downloadable" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 7 - Failed ModelListItem (no internet connection) -->
                    <templatedControls:ModelListItem
                        Title="llava:34b">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus>
                                <download:ModelDownloadStatus.DownloadState>Failed</download:ModelDownloadStatus.DownloadState>
                                <download:ModelDownloadStatus.Message>
                                    <services:LocalizationService Key="NO_INTERNET_CONNECTION"/>
                                </download:ModelDownloadStatus.Message>
                            </download:ModelDownloadStatus>
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 8 - Failed ModelListItem (not enough space) -->
                    <templatedControls:ModelListItem
                        Title="mistral:7b-instruct-q3_K_S">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus>
                                <download:ModelDownloadStatus.DownloadState>Failed</download:ModelDownloadStatus.DownloadState>
                                <download:ModelDownloadStatus.Message>
                                    <services:LocalizationService Key="NOT_ENOUGH_SPACE_DOWNLOAD"/>
                                </download:ModelDownloadStatus.Message>
                            </download:ModelDownloadStatus>
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                    <!-- Sample item 7 - Queued ModelListItem -->
                    <templatedControls:ModelListItem
                        Title="qwen3-coder:480b-a35b-q4_K_M">
                        <templatedControls:ModelListItem.DownloadStatus>
                            <download:ModelDownloadStatus DownloadState="Queued" Message="" />
                        </templatedControls:ModelListItem.DownloadStatus>
                    </templatedControls:ModelListItem>

                </StackPanel>
            </Border>
        </ThemeVariantScope>
    </Design.PreviewWith>

    <!-- Style definitions for selected ModelListItem -->
    <Style Selector="templatedControls|ModelListItem.selectedListItem">

        <!-- Model name style -->
        <Style Selector="^ /template/ TextBlock#ModelNameTextBlock">
            <Setter Property="Foreground" Value="{DynamicResource OnPrimary}" />
        </Style>

        <!-- Model background (border) style -->
        <Style Selector="^ /template/ Border#ModelBorder">
            <Setter Property="Background" Value="{DynamicResource Primary}" />
        </Style>

        <!-- Model download status text style -->
        <Style Selector="^ TextBlock.downloadStatusText">
            <Setter Property="Foreground" Value="{DynamicResource OnPrimary}" />
        </Style>

        <!-- Model download status svg style (separated for downloaded svg and other due to need of StrokeColor and FillColor styles) -->
        <Style Selector="^ controls|DynamicSvg.downloadedSvg">
            <Setter Property="StrokeColor" Value="{DynamicResource OnPrimary}" />
        </Style>
        <Style Selector="^ controls|DynamicSvg:not(.downloadedSvg)">
            <Setter Property="FillColor" Value="{DynamicResource OnPrimary}" />
        </Style>

    </Style>

    <!-- Build of ModelListItem -->
    <Style Selector="templatedControls|ModelListItem">
        <Style.Resources>
            <!-- Downloaded state templates using ModelDownloadStatusTemplateSelector which derives from IDataTemplate -->
            <!-- Template creation logic found at: /DataTemplates/ModelDownloadStatusTemplateSelector.cs -->
            <dataTemplates:ModelDownloadStatusTemplateSelector x:Key="ModelListItemDownloadStatusTemplateSelector">

                <!-- Downloaded template -->
                <DataTemplate x:Key="Downloaded" DataType="download:ModelDownloadStatus">
                    <controls:DynamicSvg
                        Path="/Assets/Svg/download.svg"
                        Height="16"
                        Classes="downloadedSvg"
                        StrokeColor="{DynamicResource OnSurface}" />
                </DataTemplate>

                <!-- Downloading template -->
                <DataTemplate x:Key="Downloading" DataType="download:ModelDownloadStatus">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                        <TextBlock Grid.Column="0"
                                   Text="{Binding $parent[templatedControls:ModelListItem].StatusText}"
                                   FontSize="12"
                                   Classes="downloadStatusText"/>
                        <controls:DynamicSvg Grid.Column="1" Path="/Assets/Svg/spinner.svg"
                                             Height="16"
                                             FillColor="{DynamicResource OnSurface}"
                                             Classes="spinnerAnimation">
                            <controls:DynamicSvg.RenderTransform>
                                <RotateTransform Angle="0" />
                            </controls:DynamicSvg.RenderTransform>
                        </controls:DynamicSvg>
                    </Grid>
                </DataTemplate>

                <!-- Paused template -->
                <DataTemplate x:Key="Paused" DataType="download:ModelDownloadStatus">
                    <controls:DynamicSvg
                        Path="/Assets/Svg/pause.svg"
                        Height="12"
                        Margin="4,0"
                        FillColor="{DynamicResource OnSurface}" />
                </DataTemplate>

                <!-- Downloadable and Failed templates (empty for now) -->
                <DataTemplate x:Key="Downloadable" DataType="download:ModelDownloadStatus" />
                <DataTemplate x:Key="Failed" DataType="download:ModelDownloadStatus" />

                <!-- Queued template -->
                <DataTemplate x:Key="Queued">
                    <TextBlock
                        Text="{services:LocalizationService Key='QUEUED'}"
                        FontSize="12"/>
                </DataTemplate>

            </dataTemplates:ModelDownloadStatusTemplateSelector>
        </Style.Resources>

        <Setter Property="Template">
            <ControlTemplate>
                <Border
                    x:Name="ModelBorder"
                    Background="{DynamicResource SurfaceContainerHighest}"
                    CornerRadius="6"
                    Padding="10,8"
                    Cursor="Hand">

                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="24">

                        <!-- Model name -->
                        <TextBlock
                            x:Name="ModelNameTextBlock"
                            Grid.Column="0"
                            Text="{TemplateBinding Title}"
                            TextTrimming="CharacterEllipsis"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Left"
                            TextAlignment="Left"
                            Foreground="{DynamicResource OnSurface}" />

                        <!-- DownloadStatus template which is received from ModelDownloadStatusTemplateSelector.cs -->
                        <ContentControl
                            Grid.Column="1"
                            Content="{TemplateBinding DownloadStatus}"
                            ContentTemplate="{StaticResource ModelListItemDownloadStatusTemplateSelector}"
                            HorizontalAlignment="Right"
                            VerticalAlignment="Center" />
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>
    </Style>
</Styles>

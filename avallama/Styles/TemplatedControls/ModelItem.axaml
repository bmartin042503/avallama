<!--
Copyright (c) Márk Csörgő and Martin Bartos
Licensed under the MIT License. See LICENSE file for details.
-->

<Styles xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:templatedControls="using:avallama.Styles.TemplatedControls"
        xmlns:services="using:avallama.Services"
        xmlns:collections="clr-namespace:System.Collections.Generic;assembly=System.Collections"
        xmlns:converters="clr-namespace:avallama.Converters"
        xmlns:vm="clr-namespace:avallama.ViewModels"
        xmlns:dataTemplates="clr-namespace:avallama.DataTemplates"
        xmlns:controls="clr-namespace:avallama.Controls"
        xmlns:ollama="clr-namespace:avallama.Models.Ollama"
        xmlns:download="clr-namespace:avallama.Models.Download"
        x:DataType="vm:ModelItemViewModel">
    <Design.PreviewWith>

        <!-- To preview the items in Light/Dark theme change the RequestedThemeVariant to "Light" or to "Dark" -->
        <ThemeVariantScope RequestedThemeVariant="Light">
            <Border Background="{DynamicResource Surface}">
                <WrapPanel Orientation="Horizontal">
                    <!-- Sample item 1 - deepseek-r1:8b - Paused download state -->
                    <templatedControls:ModelItem
                        Title="deepseek-r1:8b"
                        RunsSlow="False" Margin="40,40,0,40"
                        MaxWidth="600"
                        SizeInBytes="7200000000">
                        <templatedControls:ModelItem.Family>
                            <ollama:OllamaModelFamily
                                Name="DeepSeek"
                                Description="DeepSeek-R1 is a family of open reasoning models with performance approaching that of leading models, such as O3 and Gemini 2.5 Pro. "
                                PullCount="1234"
                                TagCount="4">

                                <ollama:OllamaModelFamily.Labels>
                                    <collections:List x:TypeArguments="x:String">
                                        <x:String>tools</x:String>
                                        <x:String>thinking</x:String>
                                        <x:String>8b</x:String>
                                    </collections:List>
                                </ollama:OllamaModelFamily.Labels>

                            </ollama:OllamaModelFamily>
                        </templatedControls:ModelItem.Family>

                        <templatedControls:ModelItem.DownloadStatus>
                            <download:ModelDownloadStatus>
                                <download:ModelDownloadStatus.DownloadState>Paused</download:ModelDownloadStatus.DownloadState>
                                <download:ModelDownloadStatus.Message />
                            </download:ModelDownloadStatus>
                        </templatedControls:ModelItem.DownloadStatus>

                        <templatedControls:ModelItem.InformationSource>
                            <collections:Dictionary x:TypeArguments="x:String, x:String">
                                <x:String x:Key="architecture">qwen3</x:String>
                                <x:String x:Key="parameters">8.19B</x:String>
                                <x:String x:Key="quantization_level">Q4_K_M</x:String>
                                <x:String x:Key="pull_count">66.6m</x:String>
                                <x:String x:Key="last_updated">2 months ago</x:String>
                                <x:String x:Key="license">MIT License Copyright (c) 2023 DeepSeek</x:String>
                            </collections:Dictionary>
                        </templatedControls:ModelItem.InformationSource>

                    </templatedControls:ModelItem>

                    <!-- Sample item 2 - llama-3.2:latest - Downloaded download state -->
                    <templatedControls:ModelItem
                        Title="llama-3.2:latest"
                        RunsSlow="True" Margin="40"
                        MaxWidth="600"
                        SizeInBytes="3200000000">

                        <templatedControls:ModelItem.Family>
                            <ollama:OllamaModelFamily
                                Name="llama:3.2"
                                Description="The Meta Llama 3.2 collection of multilingual large language models (LLMs) is a collection of pretrained and instruction-tuned generative models in 1B and 3B sizes (text in/text out). The Llama 3.2 instruction-tuned text only models are optimized for multilingual dialogue use cases, including agentic retrieval and summarization tasks. They outperform many of the available open source and closed chat models on common industry benchmarks."
                                PullCount="47200000"
                                TagCount="4">

                                <ollama:OllamaModelFamily.Labels>
                                    <collections:List x:TypeArguments="x:String">
                                        <x:String>tools</x:String>
                                        <x:String>1b</x:String>
                                        <x:String>3b</x:String>
                                    </collections:List>
                                </ollama:OllamaModelFamily.Labels>

                            </ollama:OllamaModelFamily>
                        </templatedControls:ModelItem.Family>

                        <templatedControls:ModelItem.DownloadStatus>
                            <download:ModelDownloadStatus>
                                <download:ModelDownloadStatus.DownloadState>Downloaded</download:ModelDownloadStatus.DownloadState>
                                <download:ModelDownloadStatus.Message />
                            </download:ModelDownloadStatus>
                        </templatedControls:ModelItem.DownloadStatus>

                        <templatedControls:ModelItem.InformationSource>
                            <collections:Dictionary x:TypeArguments="x:String, x:String">
                                <x:String x:Key="architecture">llama</x:String>
                                <x:String x:Key="parameters">3.21B</x:String>
                                <x:String x:Key="quantization_level">Q4_K_M</x:String>
                                <x:String x:Key="license">LLAMA 3.2 COMMUNITY LICENSE AGREEMENT Llama 3.2</x:String>
                            </collections:Dictionary>
                        </templatedControls:ModelItem.InformationSource>

                    </templatedControls:ModelItem>
                </WrapPanel>
            </Border>
        </ThemeVariantScope>

    </Design.PreviewWith>

    <!-- Build of ModelItem -->
    <Style Selector="templatedControls|ModelItem">

        <Style.Resources>
            <converters:ModelSizeConverter x:Key="ModelSizeConverter" />

            <!-- DownloadState templates using DownloadStateTemplateSelector which derives from IDataTemplate -->
            <!-- Template creation logic found at: /DataTemplates/DownloadStateTemplateSelector.cs -->
            <dataTemplates:DownloadStateTemplateSelector x:Key="ModelItemDownloadStateTemplateSelector">

                <!-- Queued template -->
                <DataTemplate x:Key="Queued" DataType="download:ModelDownloadStatus">
                    <TextBlock Text="{services:LocalizationService Key='QUEUED'}" />
                </DataTemplate>

                <!-- Failed template -->
                <DataTemplate x:Key="Failed" DataType="download:ModelDownloadStatus">
                    <TextBlock Text="{Binding Message}" />
                </DataTemplate>

                <!-- Downloadable template -->
                <DataTemplate x:Key="Downloadable" DataType="download:ModelDownloadStatus">
                    <Button Content="{services:LocalizationService Key='DOWNLOAD'}"
                            Cursor="Hand"
                            Command="{Binding $parent[vm:ModelItemViewModel].DownloadCommand}">
                    </Button>
                </DataTemplate>

                <!-- Downloading template -->
                <DataTemplate x:Key="Downloading" DataType="download:ModelDownloadStatus">
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                        <StackPanel Grid.Column="0" Orientation="Vertical" Spacing="2" Margin="0,0,8,0">
                            <TextBlock
                                Text="{Binding $parent[vm:ModelItemViewModel].LongDownloadStatusText}"
                                FontFamily="{StaticResource Manrope}"
                                VerticalAlignment="Center" FontSize="12" FontWeight="Medium" />

                            <TextBlock
                                Text="{Binding $parent[vm:ModelItemViewModel].DownloadSpeedText}"
                                FontFamily="{StaticResource Manrope}"
                                VerticalAlignment="Center" FontSize="12" FontWeight="Medium"
                                HorizontalAlignment="Right" />
                        </StackPanel>

                        <!-- Pause button -->
                        <Button Grid.Column="1" Cursor="Hand"
                                Padding="10"
                                Command="{Binding $parent[vm:ModelItemViewModel].PauseCommand}">
                            <controls:DynamicSvg Path="/Assets/Svg/pause.svg" Height="12"
                                                 FillColor="{DynamicResource OnPrimary}" />
                        </Button>

                        <!-- Cancel button -->
                        <Button Grid.Column="2" Cursor="Hand"
                                Padding="10"
                                Command="{Binding $parent[vm:ModelItemViewModel].CancelCommand}">
                            <controls:DynamicSvg Path="/Assets/Svg/close.svg" Height="12"
                                                 StrokeColor="{DynamicResource OnPrimary}" />
                        </Button>
                    </Grid>
                </DataTemplate>

                <!-- Paused template -->
                <DataTemplate x:Key="Paused" DataType="download:ModelDownloadStatus">
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="10">
                        <TextBlock Grid.Column="0"
                                   Text="{services:LocalizationService Key='DOWNLOAD_PAUSED'}"
                                   VerticalAlignment="Center" Margin="0,0,8,0" />

                        <!-- Resume button -->
                        <Button Grid.Column="1" Cursor="Hand"
                                Padding="8"
                                Command="{Binding $parent[vm:ModelItemViewModel].ResumeCommand}">
                            <controls:DynamicSvg Path="/Assets/Svg/resume.svg" Height="16"
                                                 FillColor="{DynamicResource OnPrimary}" />
                        </Button>

                        <!-- Cancel button -->
                        <Button Grid.Column="2" Cursor="Hand"
                                Padding="10"
                                Command="{Binding $parent[vm:ModelItemViewModel].CancelCommand}">
                            <controls:DynamicSvg Path="/Assets/Svg/close.svg" Height="12"
                                                 StrokeColor="{DynamicResource OnPrimary}" />
                        </Button>
                    </Grid>
                </DataTemplate>

                <!-- Downloaded template -->
                <DataTemplate x:Key="Downloaded">
                    <Button Cursor="Hand" Classes="errorButton"
                            Content="{services:LocalizationService Key='DELETE'}"
                            Command="{Binding $parent[vm:ModelItemViewModel].DeleteCommand}">
                    </Button>
                </DataTemplate>

            </dataTemplates:DownloadStateTemplateSelector>
        </Style.Resources>

        <Setter Property="Template">

            <ControlTemplate>

                <Border Padding="16"
                        BorderBrush="{DynamicResource OutlineVariant}"
                        BorderThickness="0.75"
                        Background="{DynamicResource SurfaceContainerLow}"
                        CornerRadius="10">

                    <Grid RowDefinitions="Auto,Auto,*,Auto" ColumnDefinitions="*,Auto" ColumnSpacing="32"
                          RowSpacing="20">

                        <!-- Title -->
                        <SelectableTextBlock Grid.Row="0" Grid.Column="0" Text="{TemplateBinding Title}" FontSize="26"
                                             Foreground="{DynamicResource OnSurface}"
                                             VerticalAlignment="Center" TextTrimming="CharacterEllipsis"
                                             FontFamily="{StaticResource Manrope}" />

                        <!-- Warning message -->
                        <TextBlock Grid.Row="0" Grid.Column="1"
                                   Text="{services:LocalizationService Key='MIGHT_RUN_SLOW'}"
                                   IsVisible="{TemplateBinding RunsSlow}" FontSize="14"
                                   Foreground="{DynamicResource Error}"
                                   VerticalAlignment="Center"
                                   FontFamily="{StaticResource Manrope}" />

                        <!-- Family labels -->
                        <ItemsControl
                            Grid.Row="1"
                            Grid.Column="0"
                            Grid.ColumnSpan="2"
                            ItemsSource="{Binding Model.Family.Labels}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal" ItemSpacing="12" LineSpacing="12" />
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>

                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{DynamicResource Secondary}"
                                            Padding="10,5"
                                            CornerRadius="6">
                                        <TextBlock Text="{Binding}"
                                                   Foreground="{DynamicResource OnSecondary}"
                                                   FontSize="12"
                                                   FontFamily="{StaticResource Manrope}" />
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>

                        <!-- Model information -->
                        <Border
                            Grid.Row="2"
                            Grid.Column="0"
                            Grid.ColumnSpan="2"
                            Background="{DynamicResource SurfaceContainerHighest}"
                            BorderBrush="{DynamicResource OutlineVariant}"
                            BorderThickness="0.75"
                            Padding="12"
                            CornerRadius="8">
                            <ScrollViewer HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
                                <Grid
                                    RowDefinitions="Auto,*,Auto"
                                    RowSpacing="12"
                                    ColumnSpacing="18">

                                    <!-- Family description -->
                                    <SelectableTextBlock
                                        Grid.Row="0"
                                        Text="{Binding Model.Family.Description}"
                                        FontSize="14" Foreground="{DynamicResource OnSurface}"
                                        FontFamily="{StaticResource Manrope}"
                                        TextWrapping="Wrap" />

                                    <!-- All information combined -->
                                    <SelectableTextBlock Grid.Row="1" Text="{TemplateBinding Information}"
                                                         Foreground="{DynamicResource OnSurface}"
                                                         FontSize="14" LineHeight="28"
                                                         FontFamily="{StaticResource Manrope}" />

                                    <!-- Learn more hyperlink -->
                                    <HyperlinkButton
                                        Grid.Row="2"
                                        Content="{services:LocalizationService Key='LEARN_MORE'}"
                                        Foreground="{DynamicResource Primary}" Padding="0"
                                        Cursor="Hand"
                                        Command="{Binding $parent[vm:ModelManagerViewModel].ForwardToOllamaCommand}"
                                        CommandParameter="{TemplateBinding Title}"
                                        FontFamily="{StaticResource Manrope}" FontWeight="Bold" />

                                    <!-- TODO: Token/sec speed block (+row) -->
                                </Grid>
                            </ScrollViewer>
                        </Border>

                        <Grid ColumnDefinitions="Auto,*" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="2"
                              ColumnSpacing="32">
                            <!-- Model size -->
                            <Border Grid.Column="0" Padding="12,5"
                                    Background="{DynamicResource SurfaceContainerHighest}"
                                    BorderBrush="{DynamicResource OutlineVariant}"
                                    BorderThickness="0.75"
                                    CornerRadius="6">
                                <TextBlock
                                    Text="{Binding Path=SizeInBytes, Converter={StaticResource ModelSizeConverter}, RelativeSource={RelativeSource TemplatedParent}}"
                                    FontFamily="{StaticResource Manrope}"
                                    FontSize="12" VerticalAlignment="Center" />
                            </Border>

                            <!-- DownloadState template which is received from DownloadStateTemplateSelector.cs -->
                            <ContentControl
                                Grid.Column="1"
                                Content="{TemplateBinding DownloadStatus}"
                                ContentTemplate="{StaticResource ModelItemDownloadStateTemplateSelector}"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Center" />
                        </Grid>
                    </Grid>
                </Border>
            </ControlTemplate>
        </Setter>
    </Style>
</Styles>

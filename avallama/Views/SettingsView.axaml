<!--
Copyright (c) Márk Csörgő and Martin Bartos
Licensed under the MIT License. See LICENSE file for details.
-->

<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:avallama.ViewModels"
             xmlns:services="clr-namespace:avallama.Services"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="800"
             x:Class="avallama.Views.SettingsView"
             x:DataType="vm:SettingsViewModel"
             Background="{DynamicResource Surface}">
    <Grid RowDefinitions="*,Auto">
        <ScrollViewer Grid.Row="0" Margin="22,22,8,22" AllowAutoHide="True">
            <Grid RowDefinitions="Auto,Auto,*,Auto,*">
                <TextBlock x:Name="PageTitle" Grid.Row="0" Text="{services:LocalizationService Key='SETTINGS'}"
                           Classes="H1" Margin="0,0,0,20" />

                <Grid Grid.Row="1" RowDefinitions="Auto,Auto,Auto,Auto,Auto,Auto,Auto" RowSpacing="24"
                      ColumnDefinitions="500, *"
                      Margin="0,0,26,0">
                    <!-- Language -->
                    <StackPanel Grid.Row="0" Grid.Column="0" Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock Text="{services:LocalizationService Key='LANGUAGE_SETTING'}"
                                   FontSize="18" Foreground="{DynamicResource OnSurface}" />
                        <TextBlock Text="{services:LocalizationService Key='LANGUAGE_SETTING_DESC'}"
                                   Margin="0,2,0,0" Foreground="{DynamicResource Outline}" />
                    </StackPanel>
                    <ComboBox Grid.Row="0" Grid.Column="1"
                              SelectedIndex="{Binding Mode=TwoWay, Path=SelectedLanguageIndex}"
                              VerticalAlignment="Center" Width="200" HorizontalAlignment="Right">
                        <ComboBoxItem>Magyar</ComboBoxItem>
                        <ComboBoxItem>English</ComboBoxItem>
                    </ComboBox>

                    <!-- Color scheme -->
                    <StackPanel Grid.Row="1" Grid.Column="0" Orientation="Vertical" VerticalAlignment="Center">
                        <TextBlock Text="{services:LocalizationService Key='COLOR_SCHEME_SETTING'}"
                                   FontSize="18" Foreground="{DynamicResource OnSurface}" />
                        <TextBlock Text="{services:LocalizationService Key='COLOR_SCHEME_SETTING_DESC'}"
                                   Margin="0,2,0,0" Foreground="{DynamicResource Outline}" />
                    </StackPanel>
                    <ComboBox Grid.Row="1" Grid.Column="1"
                              SelectedIndex="{Binding Mode=TwoWay, Path=SelectedThemeIndex}"
                              VerticalAlignment="Center" Width="200" HorizontalAlignment="Right">
                        <ComboBoxItem Content="{services:LocalizationService Key='SYSTEM_COLOR_SCHEME'}" />
                        <ComboBoxItem Content="{services:LocalizationService Key='LIGHT_THEME'}" />
                        <ComboBoxItem Content="{services:LocalizationService Key='DARK_THEME'}" />
                    </ComboBox>

                    <!-- Scroll setting -->
                    <StackPanel Grid.Row="2" Grid.Column="0" VerticalAlignment="Center">
                        <TextBlock Text="{services:LocalizationService Key='SCROLL_TO_BOTTOM_SETTING'}"
                                   FontSize="18" Foreground="{DynamicResource OnSurface}" />
                        <TextBlock Text="{services:LocalizationService Key='SCROLL_TO_BOTTOM_SETTING_DESC'}"
                                   Margin="0,2,0,0" Foreground="{DynamicResource Outline}" />
                    </StackPanel>
                    <ComboBox Grid.Row="2" Grid.Column="1"
                              SelectedIndex="{Binding Mode=TwoWay, Path=SelectedScrollIndex}"
                              VerticalAlignment="Center" Width="200" HorizontalAlignment="Right">
                        <ComboBoxItem>
                            <services:LocalizationService Key="SCROLL_AUTOMATIC" />
                        </ComboBoxItem>
                        <ComboBoxItem>
                            <services:LocalizationService Key="SCROLL_FLOATING" />
                        </ComboBoxItem>
                        <ComboBoxItem>
                            <services:LocalizationService Key="NONE" />
                        </ComboBoxItem>
                    </ComboBox>

                    <!-- Host and port setting -->
                    <StackPanel Grid.Row="3" Grid.Column="0" VerticalAlignment="Center">
                        <TextBlock Text="{services:LocalizationService Key='API_HOST_SETTING'}"
                                   FontSize="18" Foreground="{DynamicResource OnSurface}" />
                        <TextBlock Text="{services:LocalizationService Key='API_HOST_SETTING_DESC'}"
                                   Margin="0,2,0,0" Foreground="{DynamicResource Outline}" />
                    </StackPanel>
                    <TextBox Grid.Row="3" Grid.Column="1" VerticalAlignment="Center" Width="200"
                             HorizontalAlignment="Right"
                             Text="{Binding ApiHost}" Classes="settingTextBox" MaxLines="1">
                    </TextBox>

                    <StackPanel Grid.Row="4" Grid.Column="0" VerticalAlignment="Center">
                        <TextBlock Text="{services:LocalizationService Key='API_PORT_SETTING'}"
                                   FontSize="18" Foreground="{DynamicResource OnSurface}" />
                        <TextBlock Text="{services:LocalizationService Key='API_PORT_SETTING_DESC'}"
                                   Margin="0,2,0,0" Foreground="{DynamicResource Outline}" />
                    </StackPanel>
                    <TextBox Grid.Row="4" Grid.Column="1" VerticalAlignment="Center" Width="200"
                             HorizontalAlignment="Right"
                             Text="{Binding ApiPort}" Classes="settingTextBox" MaxLines="1">
                    </TextBox>

                    <!-- Model informational messages setting -->
                    <StackPanel Grid.Row="5" Grid.Column="0" VerticalAlignment="Center">
                        <TextBlock Text="{services:LocalizationService Key='SHOW_INFORMATIONAL_SETTING'}"
                                   FontSize="18" Foreground="{DynamicResource OnSurface}" />
                        <TextBlock Text="{services:LocalizationService Key='SHOW_INFORMATIONAL_SETTING_DESC'}"
                                   Margin="0,2,0,0" Foreground="{DynamicResource Outline}"
                                   TextWrapping="Wrap" />
                    </StackPanel>
                    <ToggleSwitch Grid.Row="5" Grid.Column="1" IsChecked="{Binding ShowInformationalMessages}"
                                  VerticalAlignment="Center" HorizontalAlignment="Right" Cursor="Hand"
                                  OffContent="{services:LocalizationService Key='OFF'}"
                                  OnContent="{services:LocalizationService Key='ON'}" />

                    <!-- Reset settings to default -->
                    <Button Grid.Row="6" Grid.Column="1" Margin="0,20,0,0"
                            Content="{services:LocalizationService Key='RESET_TO_DEFAULT'}"
                            HorizontalAlignment="Right" Cursor="Hand" Classes="secondaryButton"
                            Command="{Binding ResetSettingsToDefault}" />

                    <StackPanel Grid.Row="6" Grid.Column="0" HorizontalAlignment="Left" Orientation="Horizontal"
                                Spacing="14" Margin="0,20,0,0">
                        <!-- Update model library -->
                        <Button Content="{services:LocalizationService Key='UPDATE_MODEL_LIBRARY'}"
                                HorizontalAlignment="Left" Cursor="Hand" Classes="secondaryButton"
                                Command="{Binding Path=((vm:MainViewModel)DataContext).StartScraper, RelativeSource={RelativeSource AncestorType=Window}}" />
                        <TextBlock Text="{Binding LastModelUpdate}"
                                   FontSize="14"
                                   VerticalAlignment="Center"/>
                    </StackPanel>
                </Grid>

                <!-- About container -->
                <Border Grid.Row="2" CornerRadius="15" Padding="10"
                        Background="{DynamicResource SurfaceContainer}"
                        Margin="0,40,14,0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Spacing="3" Orientation="Vertical">
                            <TextBlock Text="Avallama" FontWeight="Bold" FontSize="18" />
                            <TextBlock Text="{services:LocalizationService Key='SHORT_DESC'}" FontStyle="Italic" />
                            <TextBlock Margin="0,16,0,0">
                                <Run Text="{services:LocalizationService Key='VERSION_LABEL'}" FontWeight="Bold" />
                                <Run Text="{services:LocalizationService Key='VERSION'}" />
                            </TextBlock>
                            <TextBlock>
                                <Run Text="{services:LocalizationService Key='DEVELOPERS'}" FontWeight="Bold" />
                                <Run Text="{services:LocalizationService Key='DEVELOPER_NAMES'}" />
                            </TextBlock>
                            <TextBlock>
                                <Run Text="{services:LocalizationService Key='TECH_USED'}" FontWeight="Bold" />
                                <Run Text="Ollama API, Avalonia framework" />
                            </TextBlock>
                            <TextBlock Margin="0,16,0,0">
                                <Run Text="{services:LocalizationService Key='LICENSE'}" />
                            </TextBlock>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="{services:LocalizationService Key='GITHUB_BUTTON'}"
                                        Cursor="Hand"
                                        CornerRadius="4"
                                        Margin="0,5,0,0"
                                        FontSize="14"
                                        Padding="6"
                                        Command="{Binding OnHyperlinkClicked}" />
                            </StackPanel>
                            <Separator Margin="0,16,0,0" Opacity="0.3" />
                            <TextBlock HorizontalAlignment="Center" Margin="0,16,0,0" VerticalAlignment="Bottom">
                                <Run Text="Copyright" FontWeight="Bold" />
                                <Run Text="© 2025 Márk Csörgő and Martin Bartos" />
                            </TextBlock>
                            <TextBlock Text="{services:LocalizationService Key='FROM_ORG'}"
                                       HorizontalAlignment="Center"
                                       FontStyle="Italic" ClipToBounds="False" />
                        </StackPanel>
                    </ScrollViewer>
                </Border>
            </Grid>
        </ScrollViewer>
        <StackPanel Grid.Row="1" HorizontalAlignment="Right" Spacing="14" Margin="0,22,22,22" Orientation="Horizontal"
                    VerticalAlignment="Bottom">
            <TextBlock Text="{services:LocalizationService Key='SETTINGS_SAVED'}"
                       Margin="0,0,10,0"
                       IsVisible="{Binding IsChangesSavedTextVisible}"
                       FontSize="14" Foreground="{DynamicResource Outline}" HorizontalAlignment="Left"
                       VerticalAlignment="Center" />
            <Button
                Command="{Binding Path=((vm:MainViewModel)DataContext).OpenHome, RelativeSource={RelativeSource AncestorType=Window}}"
                Classes="secondaryButton"
                Cursor="Hand" HorizontalAlignment="Center"
                Content="{services:LocalizationService Key='BACK'}" />
            <Button Command="{Binding Save}"
                    Cursor="Hand" HorizontalAlignment="Center"
                    Click="SaveBtn_OnClick"
                    Content="{services:LocalizationService Key='SAVE'}" />
        </StackPanel>
    </Grid>
</UserControl>
